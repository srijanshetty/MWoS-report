\documentclass[11pt,oneside]{book}
\pagestyle{plain}
\usepackage{graphics}
\usepackage{makeidx}
\usepackage{nomencl}
\usepackage{listings}

\textheight=235mm
\textwidth=145mm
\topmargin=0mm
\headheight=0mm
\headsep=0mm

% These must be changed for double sided output !

\oddsidemargin=15mm
\evensidemargin=15mm

% Custom commands
\newcommand{\mychapter}[2]{
    \setcounter{chapter}{#1}
    \setcounter{section}{0}
    \chapter*{#2}
    \addcontentsline{toc}{chapter}{#2}
}

\makeindex
\makeglossary
\begin{document}

% set line spacing to 1.5B
\baselineskip = 17pt

\title{Multifactor Authentication and Session Support in OpenVPN}
\author{Report submitted in accordance with the requirements of \\
the Indian Institute of Technology, Kanpur \\
by \\
Harshwardhan Sharma (),\\
Shivanshu Agarwal (),\\
Srijan R. Shetty (11727)}
\date{November 2014}
\maketitle
\frontmatter

\chapter{Abstract}
Mozilla uses OpenVPN with MFA via deferred C plugins and pythons scripts.
However, there are several caveats that require non-plugin based modifications,
such as One Time Passwords (OTP) client input and session tracking.
The goal of this project has been to research and provide a first class user experience
to the end user when using MFA with OpenVPN; including the support for session resumption
and backwards compatibility with older versions of OpenVPN.

% Contents not put in table of contents by default so add it separately
\tableofcontents
\addcontentsline{toc}{chapter}{Contents}

% List of figures  not put in table of contents by default so add it separately
\listoffigures
\addcontentsline{toc}{chapter}{List of Figures}


\chapter{Acknowledgement}
The authors would like to thank Professor Dheeraj Sanghi for his continued guidance
and support, Guillaume Destuynder of Mozilla who mentored the authors despite his
hectic schedule and lastly Mozilla for giving the authors an oppurtunity to work on
a project like OpenVPN under its aegis.\\
The authors wish to thank the University of
Liverpool Computing Services Department for the development of this
\LaTeX \ thesis template.

% Create glossary and add
\printglossary
\addcontentsline{toc}{chapter}{Nomenclature}

\mainmatter

\chapter{OpenVPN}
\section{Introduction}
A Virtual Private network allows two devices to securely communicate with each other
over a possibly insecure public network. This concept when extended to networks
allows for secure communications between different private networks over an
insecure network (most often the internet), thereby creating a virtual super-network.

OpenVPN \footnote{http://openvpn.net} is a GNU General Public
Licensed \footnote{http://www.gnu.org/copyleft/gpl.html} implementation of a
Virtual Private Network written in C maintained by the OpenVPN project.

\section{Architecture}
\textbf{TODO}

\section{Protocol}
OpenVPN uses a custom protocol for communications which is attached in appendix
\ref{OpenVPN:protocol} on page \pageref{OpenVPN:protocol} for perusal.

\chapter{Multifactor Authentication}
\section{Introduction}
Multifactor Authentication, henceforth used interchangeably with MFA, hardens access control
by challenging a user on at least two out of the following three factors of authentication.

\begin{enumerate}
    \item \emph{Knowledge Factor}: The knowledge factor of authentication comprises of
        authentication methods which tests the user for the knowledge of a pre-shared secret.
        \emph{"things only the user knows"}. For example: ATM Pins, website passwords.
    \item \emph{Possession Factor}: The possession factor of authentication comprises of
        authentication methods which tests the user for the possession of an entity.
        \emph{"things only the user has"}. For example: Smart cards, ATM Cards.
    \item \emph{Inherence Factor}: The inherence factor of authentication comprises of
        authentication methods which tests the user for possession of \emph{"things only
        the user is"}. For example: Retinal scans, Fingerprint scans.
\end{enumerate}

While conventional methods of authentication only take into account a knowledge factor,
(most internet websites which a username password mechanism to authenticate users)
multi factor authentication includes at least two different factors from the aforementioned
list and might even have multiple authentication methods for a particular factor.

\section{Implementation}
\subsection{Current Architecture}
The current architecture of OpenVPN supports two key methods:

\begin{enumerate}
    \item \emph{Key Method 1}, the legacy key method only checks for the validity of certificates.
        Refer to Appendix \ref{OpenVPN:protocol} on page \pageref{OpenVPN:protocol} for details.
    \item \emph{Key Method 2}, in addition to checking for the validity of certificates, allows for
        authentication of the user through username and password. The verification of username and
        password is delegated to either a script or a plugin which returns a binary result
        indicating a success or failure.
        Refer to Appendix \ref{OpenVPN:protocol} on page \pageref{OpenVPN:protocol} for details.
\end{enumerate}

\subsection{MFA types}
The current implementation of MFA in OpenVPN supports three different MFA types, which differ
in the credentials required by the user to complete the authentication.

\begin{enumerate}
    \item \emph{OTP}: A one time password consist of only a password which can be conveniently
        delivered to the user using SMS, an OTP-stick, or an application like Google Authenticator.
    \item \emph{USER-PASS}: The conventional username-password scheme requires the user to provide
        both a username and password.
    \item \emph{PUSH}: No input is required by the user in a push message except the confirmation
        of a push from a pre selected device.
\end{enumerate}

\subsection{Augmentation}
The packet structure of key method 2 - Appendix \ref{OpenVPN:protocol}, \pageref{OpenVPN:protocol} -
was augmented with the addition of MFA-username and MFA-password in the options field of the packet
just after username and password for AUTH-USERPASS.

Three new OpenVPN plugin types have been introduced to support MFA.

\begin{itemize}
     \item OPENVPN\_PLUGIN\_AUTH\_MFA\_PUSH\_VERIFY
     \item OPENVPN\_PLUGIN\_AUTH\_MFA\_OTP\_VERIFY
     \item OPENVPN\_PLUGIN\_AUTH\_MFA\_USER\_PASS\_VERIFY
\end{itemize}

In case of OTP authentication, the username field is set to the Common Name of the user and the OTP
is sent as the password. The Common Name is sent as the username in PUSH with an empty string as
password. The username and password fields are populated with the user supplied values in case of
USER-PASS.

The actual implementation of the each of these kinds of MFA is left to the plugin/script writer.
OpenVPN simply calls the registered plugin/script when asked to perform multifactor authentication
with a specified type and waits for a success/failure response. On receiving a success, OpenVPN
continues on with the rest of the protocol; and on receiving a failure, OpenVPN immediately
terminates the client connection by sending the client a \emph{SIGTERM} signal. This allows for
multiple plugins/scripts to be created for a particular type of MFA.

\section{Configuration}
\subsection{Server}
To enable multifactor authentication in the server using a script, the following line needs to be
included in the configuration file of the server:

\begin{verbatim}
    mfa-method [method-type] [script file name] [via-env/via-file]
\end{verbatim}

\noindent Here method-type is one of 'otp', 'push' or 'user-pass'. For example:
\begin{verbatim}
    mfa-method otp auth.pl via-file
\end{verbatim}

\noindent Multifactor authentication can also be enabled using plugins, the incantation for the same is:
\begin{verbatim}
    mfa-method [method-type]
    plugin [plugin shared object file]
\end{verbatim}

\subsection{Client}
To enable multifactor authentication in the client, the following line needs to be included in the
configuration file of the client:

\begin{verbatim}
    mfa-method [method-type]
\end{verbatim}

\section{Backwards Compatibility}
\textbf{TODO}

% \include{chapter2}

\appendix
\chapter{OpenVPN Protocol}
\label{OpenVPN:protocol}
\lstinputlisting{protocol.c}

\bibliographystyle{plain}
\bibliography{thesis}
\addcontentsline{toc}{chapter}{Bibliography}

\printindex
\addcontentsline{toc}{chapter}{Index}

\begin{verbatim}










\end{verbatim}
\end{document}
